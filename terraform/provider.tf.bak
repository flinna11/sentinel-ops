terraform {
  required_providers {
    proxmox = {
      source  = "telmate/proxmox"
      version = "3.0.2-rc03" # Updated for Proxmox 9
    }
  }
}

provider "proxmox" {
  pm_api_url          = "https://192.168.1.104:8006/api2/json"
  pm_api_token_id     = var.proxmox_token_id
  pm_api_token_secret = var.proxmox_token_secret
  pm_tls_insecure     = true
  pm_parallel         = 2
  pm_timeout          = 600

# Crucial fix for Proxmox 9 compatibility
  pm_minimum_permission_check = false

# These lines help bypass and troubleshoot permission loops
  pm_log_enable       = true
  pm_debug            = true
}

provider "helm" {
  # Change from a block to an attribute by using the '=' sign
  kubernetes = {
    config_path = "~/.kube/config-sentinel"
  }
}


provider "kubernetes" {
  config_path = "~/.kube/config-sentinel"
}

